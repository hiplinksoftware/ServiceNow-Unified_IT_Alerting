<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_hls_hiplink.hiplink_contacts_sync_operations</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>hiplink_contacts_sync_operations</name>
        <script><![CDATA[var hiplink_contacts_sync_operations = Class.create();
hiplink_contacts_sync_operations.prototype = {
    initialize: function () {

        this.objSystemProperties = hiplink_system_properties.getInstance();
        this.objDataOperations = hiplink_data_operations.getInstance();
        this.objHipLinkWebService = hiplink_web_service_consumer.getInstance();
    },

    addHLReceiverForUserRole: function (userHasRole) {

        var userRoleID = userHasRole.role.toString();
        var userID = userHasRole.user.toString();

        var receiver = this.getHLReceiverData(userRoleID, null, userID, null);

        if (receiver.name !== '') {

            this.invokeAddReceiver(receiver);

            var assignedUserRoleNames = [
                receiver.roleName
            ];

            var assignedUserGroupIDs = this.objDataOperations.getAssignedUserGroupIDs(userID);

            for (var i = 0; i < assignedUserGroupIDs.length; i++) {

                var recipGroupMembers = this.getHLRecipGroupsMembersData(assignedUserGroupIDs[i], userID, null, assignedUserRoleNames);

                this.addHLRecipGroupMembers(null, null, recipGroupMembers);
            }
        }
    },

    deleteHLReceiverForUserRole: function (userHasRole) {

        var userRoleID = userHasRole.role.toString();
        var userID = userHasRole.user.toString();

        var receiverName = this.getHLReceiverName(userRoleID, null, userID, null);

        if (receiverName !== '') {
            this.invokeDeleteReceiver(receiverName);
        }
    },

    addHLReceiversForUser: function (user) {

        var userID = user.sys_id.toString();

        var assignedUserRoleNames = this.objDataOperations.getAssignedUserRoleNames(userID);

        var i;
        for (i = 0; i < assignedUserRoleNames.length; i++) {

            var userRoleName = assignedUserRoleNames[i];

            var receiver = this.getHLReceiverData(null, userRoleName, null, user);

            if (receiver.name !== '') {
                this.invokeAddReceiver(receiver);
            }
        }

        var assignedUserGroupIDs = this.objDataOperations.getAssignedUserGroupIDs(userID);

        for (i = 0; i < assignedUserGroupIDs.length; i++) {

            var recipGroupMembers = this.getHLRecipGroupsMembersData(assignedUserGroupIDs[i], userID, null, assignedUserRoleNames);

            this.addHLRecipGroupMembers(null, null, recipGroupMembers);
        }
    },

    deleteHLReceiversForUser: function (user, assignedUserRoleNames) {

        var userID = user.sys_id.toString();

        if (typeof assignedUserRoleNames === 'undefined'
            || assignedUserRoleNames === null) {

            assignedUserRoleNames = this.objDataOperations.getAssignedUserRoleNames(userID);
        }

        var i;
        for (i = 0; i < assignedUserRoleNames.length; i++) {

            var userRoleName = assignedUserRoleNames[i];

            var receiverName = this.getHLReceiverName(null, userRoleName, null, user);

            if (receiverName !== '') {
                this.invokeDeleteReceiver(receiverName);
            }
        }
    },

    updateHLReceiversForUser: function (userPrevious, userCurrent) {

        var userID = userCurrent.sys_id.toString();

        var assignedUserRoleNames = this.objDataOperations.getAssignedUserRoleNames(userID);

        var i;
        for (i = 0; i < assignedUserRoleNames.length; i++) {

            var userRoleName = assignedUserRoleNames[i];

            var receiver = this.getHLReceiverData(null, userRoleName, null, userCurrent);

            if (receiver.name !== '') {

                var receiverName = this.getHLReceiverName(null, userRoleName, null, userPrevious);

                if (receiverName === '') {
                    receiverName = receiver.name;
                }

                var isReceiverUpdated = this.invokeUpdateReceiver(receiverName, receiver);

                if (isReceiverUpdated === false) {
                    this.invokeAddReceiver(receiver);
                }
            }
        }

        var assignedUserGroupIDs = this.objDataOperations.getAssignedUserGroupIDs(userID);

        for (i = 0; i < assignedUserGroupIDs.length; i++) {

            var recipGroupMembers = this.getHLRecipGroupsMembersData(assignedUserGroupIDs[i], userID, null, assignedUserRoleNames);

            this.addHLRecipGroupMembers(null, null, recipGroupMembers);
        }
    },

    updateHLReceiversForSystemProperty: function (systemPropertyPrevious, systemPropertyCurrent) {

        var propertyName = systemPropertyCurrent.name.toString();

        var objSysProp = this.objSystemProperties;

        var namePrefixPrevious = objSysProp.recipient_name_ident.prefix;
        var nameSuffixPrevious = objSysProp.recipient_name_ident.suffix;

        if (propertyName.indexOf('x_hls_hiplink.recipient_name_ident') > 0
            || propertyName.indexOf('x_hls_hiplink.multi_department') > 0) {

            if (propertyName === 'x_hls_hiplink.recipient_name_ident.prefix') {
                namePrefixPrevious = systemPropertyPrevious.value.toString();
            }
            else if (propertyName === 'x_hls_hiplink.recipient_name_ident.suffix') {
                nameSuffixPrevious = systemPropertyPrevious.value.toString();
            }

            this.objContactsSyncOperations.updateHLReceiversForAllUsers('email',
                namePrefixPrevious, nameSuffixPrevious,
                objSysProp.receiver_profile.email.name_suffix);

            this.objContactsSyncOperations.updateHLReceiversForAllUsers('hiplink_mobile',
                namePrefixPrevious, nameSuffixPrevious,
                objSysProp.receiver_profile.hiplink_mobile.name_suffix);

            this.objContactsSyncOperations.updateHLReceiversForAllUsers('sms_text',
                namePrefixPrevious, nameSuffixPrevious,
                objSysProp.receiver_profile.sms_text.name_suffix);

            this.objContactsSyncOperations.updateHLReceiversForAllUsers('voice_call',
                namePrefixPrevious, nameSuffixPrevious,
                objSysProp.receiver_profile.voice_call.name_suffix);
        }
        else if (propertyName.indexOf('x_hls_hiplink.receiver_profile') > 0) {

            var carrierSuffixPrevious;

            if (propertyName.indexOf('x_hls_hiplink.receiver_profile.email') > 0) {

                carrierSuffixPrevious = objSysProp.receiver_profile.email.name_suffix;

                if (propertyName === 'x_hls_hiplink.receiver_profile.email.name_suffix') {
                    carrierSuffixPrevious = systemPropertyPrevious.value.toString();
                }

                this.objContactsSyncOperations.updateHLReceiversForAllUsers('email',
                    namePrefixPrevious, nameSuffixPrevious,
                    carrierSuffixPrevious);
            }
            else if (propertyName.indexOf('x_hls_hiplink.receiver_profile.hiplink_mobile') > 0) {

                carrierSuffixPrevious = objSysProp.receiver_profile.hiplink_mobile.name_suffix;

                if (propertyName === 'x_hls_hiplink.receiver_profile.hiplink_mobile.name_suffix') {
                    carrierSuffixPrevious = systemPropertyPrevious.value.toString();
                }

                this.objContactsSyncOperations.updateHLReceiversForAllUsers('hiplink_mobile',
                    namePrefixPrevious, nameSuffixPrevious,
                    carrierSuffixPrevious);
            }
            else if (propertyName.indexOf('x_hls_hiplink.receiver_profile.sms_text') > 0) {

                carrierSuffixPrevious = objSysProp.receiver_profile.sms_text.name_suffix;

                if (propertyName === 'x_hls_hiplink.receiver_profile.sms_text.name_suffix') {
                    carrierSuffixPrevious = systemPropertyPrevious.value.toString();
                }

                this.objContactsSyncOperations.updateHLReceiversForAllUsers('sms_text',
                    namePrefixPrevious, nameSuffixPrevious,
                    carrierSuffixPrevious);
            }
            else if (propertyName.indexOf('x_hls_hiplink.receiver_profile.voice_call') > 0) {

                carrierSuffixPrevious = objSysProp.receiver_profile.voice_call.name_suffix;

                if (propertyName === 'x_hls_hiplink.receiver_profile.voice_call.name_suffix') {
                    carrierSuffixPrevious = systemPropertyPrevious.value.toString();
                }

                this.objContactsSyncOperations.updateHLReceiversForAllUsers('voice_call',
                    namePrefixPrevious, nameSuffixPrevious,
                    carrierSuffixPrevious);
            }
        }
    },

    updateHLReceiversForAllUsers: function (carrierType, namePrefixPrevious, nameSuffixPrevious, carrierSuffixPrevious) {

        var assignedUsers = this.objDataOperations.getAllAssignedUsers(carrierType);

        for (var userID in assignedUsers) {

            var assignedUserRoleNames = assignedUsers[userID];

            var i;
            for (i = 0; i < assignedUserRoleNames.length; i++) {

                var userRoleName = assignedUserRoleNames[i];

                var receiver = this.getHLReceiverData(null, userRoleName, userID, null);

                if (receiver.name !== '') {

                    var namePrefixCurrent = this.objSystemProperties.recipient_name_ident.prefix;
                    var nameSuffixCurrent = this.objSystemProperties.recipient_name_ident.suffix;
                    var carrierSuffixCurrent = this.objSystemProperties.receiver_profile[carrierType].name_suffix;

                    this.objSystemProperties.recipient_name_ident.prefix = namePrefixPrevious;
                    this.objSystemProperties.recipient_name_ident.suffix = nameSuffixPrevious;
                    this.objSystemProperties.receiver_profile[carrierType].name_suffix = carrierSuffixPrevious;

                    var receiverName = this.getHLReceiverName(null, userRoleName, userID, null);

                    if (receiverName === '') {
                        receiverName = receiver.name;
                    }

                    var isReceiverUpdated = this.invokeUpdateReceiver(receiverName, receiver);

                    if (isReceiverUpdated === false) {
                        this.invokeAddReceiver(receiver);
                    }

                    this.objSystemProperties.recipient_name_ident.prefix = namePrefixCurrent;
                    this.objSystemProperties.recipient_name_ident.suffix = nameSuffixCurrent;
                    this.objSystemProperties.receiver_profile[carrierType].name_suffix = carrierSuffixCurrent;
                }
            }

            var assignedUserGroupIDs = this.objDataOperations.getAssignedUserGroupIDs(userID);

            for (i = 0; i < assignedUserGroupIDs.length; i++) {

                var recipGroupMembers = this.getHLRecipGroupsMembersData(assignedUserGroupIDs[i], userID, null, assignedUserRoleNames);

                this.addHLRecipGroupMembers(null, null, recipGroupMembers);
            }
        }
    },

    addHLRecipGroupForGroupRole: function (groupHasRole) {

        var groupRoleID = groupHasRole.role.toString();
        var groupID = groupHasRole.group.toString();

        var recipGroup = this.getHLRecipGroupData(groupRoleID, null, groupID, null);

        if (recipGroup.name !== '') {

            this.invokeAddRecipGroup(recipGroup);

            var assignedGroupRoleNames = [
                recipGroup.roleName
            ];

            var assignedGroupMemberIDs = this.objDataOperations.getAssignedGroupMemberIDs(groupID);

            for (var i = 0; i < assignedGroupMemberIDs.length; i++) {

                var recipGroupMembers = this.getHLRecipGroupsMembersData(groupID, assignedGroupMemberIDs[i], assignedGroupRoleNames, null);

                this.addHLRecipGroupMembers(null, null, recipGroupMembers);
            }
        }
    },

    deleteHLRecipGroupForGroupRole: function (groupHasRole) {

        var groupRoleID = groupHasRole.role.toString();
        var groupID = groupHasRole.group.toString();

        var recipGroupName = this.getHLRecipGroupName(groupRoleID, null, groupID, null);

        if (recipGroupName !== '') {
            this.invokeDeleteRecipGroup(recipGroupName);
        }
    },

    addHLRecipGroupsForGroup: function (group) {

        var groupID = group.sys_id.toString();

        var assignedGroupRoleNames = this.objDataOperations.getAssignedGroupRoleNames(groupID);

        var i;
        for (i = 0; i < assignedGroupRoleNames.length; i++) {

            var groupRoleName = assignedGroupRoleNames[i];

            var recipGroup = this.getHLRecipGroupData(null, groupRoleName, null, group);

            if (recipGroup.name !== '') {
                this.invokeAddRecipGroup(recipGroup);
            }
        }

        var assignedGroupMemberIDs = this.objDataOperations.getAssignedGroupMemberIDs(groupID);

        for (i = 0; i < assignedGroupMemberIDs.length; i++) {

            var recipGroupMembers = this.getHLRecipGroupsMembersData(groupID, assignedGroupMemberIDs[i], assignedGroupRoleNames, null);

            this.addHLRecipGroupMembers(null, null, recipGroupMembers);
        }
    },

    deleteHLRecipGroupsForGroup: function (group, assignedGroupRoleNames) {

        var groupID = group.sys_id.toString();

        if (typeof assignedGroupRoleNames === 'undefined'
            || assignedGroupRoleNames === null) {

            assignedGroupRoleNames = this.objDataOperations.getAssignedGroupRoleNames(groupID);
        }

        var i;
        for (i = 0; i < assignedGroupRoleNames.length; i++) {

            var groupRoleName = assignedGroupRoleNames[i];

            var recipGroupName = this.getHLRecipGroupName(null, groupRoleName, null, group);

            if (recipGroupName !== '') {
                this.invokeDeleteRecipGroup(recipGroupName);
            }
        }
    },

    updateHLRecipGroupsForGroup: function (groupPrevious, groupCurrent) {

        var groupID = groupCurrent.sys_id.toString();

        var assignedGroupRoleNames = this.objDataOperations.getAssignedGroupRoleNames(groupID);

        var i;
        for (i = 0; i < assignedGroupRoleNames.length; i++) {

            var groupRoleName = assignedGroupRoleNames[i];

            var recipGroup = this.getHLRecipGroupData(null, groupRoleName, null, groupCurrent);

            if (recipGroup.name !== '') {

                var recipGroupName = this.getHLRecipGroupName(null, groupRoleName, null, groupPrevious);

                if (recipGroupName === '') {
                    recipGroupName = recipGroup.name;
                }

                var isRecipGroupUpdated = this.invokeUpdateRecipGroup(recipGroupName, recipGroup);

                if (isRecipGroupUpdated === false) {
                    this.invokeAddRecipGroup(recipGroup);
                }
            }
        }

        var assignedGroupMemberIDs = this.objDataOperations.getAssignedGroupMemberIDs(groupID);

        for (i = 0; i < assignedGroupMemberIDs.length; i++) {

            var recipGroupMembers = this.getHLRecipGroupsMembersData(groupID, assignedGroupMemberIDs[i], assignedGroupRoleNames, null);

            this.addHLRecipGroupMembers(null, null, recipGroupMembers);
        }
    },

    addHLRecipGroupMembersForGroupMember: function (groupMember) {

        this.addHLRecipGroupMembers(groupMember.group.toString(), groupMember.user.toString());
    },

    deleteHLRecipGroupMembersForGroupMember: function (groupMember) {

        this.deleteHLRecipGroupMembers(groupMember.group.toString(), groupMember.user.toString());
    },

    addHLRecipGroupMembers: function (groupID, userID, recipGroupMembers) {

        if (typeof recipGroupMembers === 'undefined'
            || recipGroupMembers === null) {

            recipGroupMembers = this.getHLRecipGroupsMembersData(groupID, userID);
        }

        for (var rg in recipGroupMembers) {

            if (recipGroupMembers[rg].name !== '') {

                for (var i = 0; i < recipGroupMembers[rg].members.length; i++) {

                    if (recipGroupMembers[rg].members[i] !== '') {
                        this.invokeAddRecipGroupMember(recipGroupMembers[rg].name, recipGroupMembers[rg].members[i]);
                    }
                }
            }
        }
    },

    deleteHLRecipGroupMembers: function (groupID, userID, recipGroupMembers) {

        if (typeof recipGroupMembers === 'undefined'
            || recipGroupMembers === null) {

            recipGroupMembers = this.getHLRecipGroupsMembersData(groupID, userID);
        }

        for (var rg in recipGroupMembers) {

            if (recipGroupMembers[rg].name !== '') {

                for (var i = 0; i < recipGroupMembers[rg].members.length; i++) {

                    if (recipGroupMembers[rg].members[i] !== '') {
                        this.invokeDeleteRecipGroupMember(recipGroupMembers[rg].name, recipGroupMembers[rg].members[i]);
                    }
                }
            }
        }
    },

    getHLReceiverData: function (userRoleID, userRoleName, userID, user) {

        var receiver = {
            roleName: '',
            name: '',
            description: '',
            department: '',
            carrier: '',
            pin: '',
            type: '',
            firstName: '',
            lastName: '',
            emailAddress: '',
            emailCC: '',
            emailFailover: '',
            assignedOwner: '',
            autoAssignOwner: '',
            ownerUserGroup: '',
            disabled: ''
        };

        if (userRoleName === null && userRoleID !== null) {
            userRoleName = this.objDataOperations.getUserRoleName(userRoleID);
        }

        if (userRoleName !== null && userRoleName !== '') {

            receiver.roleName = userRoleName;

            if (user === null && userID !== null) {
                user = this.objDataOperations.getUser(userID);
            }
        }

        if (userRoleName !== null && user !== null) {

            var objSysProp = this.objSystemProperties;

            receiver.name = objSysProp.recipient_name_ident.prefix
                + user.user_name.toString();
            receiver.description = user.first_name.toString()
                + ' ' + user.last_name.toString()
                + ', ' + user.title.toString();

            receiver.emailAddress = user.email.toString();

            if (userRoleName.lastIndexOf('.email') > 0) {

                receiver.name += objSysProp.receiver_profile.email.name_suffix;
                receiver.description += objSysProp.receiver_profile.email.description_suffix;

                receiver.carrier = objSysProp.receiver_profile.email.carrier_name;
                receiver.pin = objSysProp.receiver_profile.email.pin_prefix
                    + user.email.toString()
                    + objSysProp.receiver_profile.email.pin_suffix;
                receiver.type = objSysProp.receiver_profile.email.type;

                if (receiver.emailAddress !== '') {

                    receiver.emailCC = objSysProp.receiver_profile.email.email_cc;
                    receiver.emailFailover = objSysProp.receiver_profile.email.email_failover;
                }
            }
            else if (userRoleName.lastIndexOf('.hiplink_mobile') > 0) {

                receiver.name += objSysProp.receiver_profile.hiplink_mobile.name_suffix;
                receiver.description += objSysProp.receiver_profile.hiplink_mobile.description_suffix;

                receiver.carrier = objSysProp.receiver_profile.hiplink_mobile.carrier_name;
                receiver.pin = objSysProp.receiver_profile.hiplink_mobile.pin_prefix
                    + user.user_name.toString()
                    + objSysProp.receiver_profile.hiplink_mobile.pin_suffix;
                receiver.type = objSysProp.receiver_profile.hiplink_mobile.type;

                if (receiver.emailAddress !== '') {

                    receiver.emailCC = objSysProp.receiver_profile.hiplink_mobile.email_cc;
                    receiver.emailFailover = objSysProp.receiver_profile.hiplink_mobile.email_failover;
                }

                if (objSysProp.receiver_profile.hiplink_mobile.auto_assign_owner) {
                    receiver.autoAssignOwner = 'true';
                    receiver.ownerUserGroup = objSysProp.receiver_profile.hiplink_mobile.owner_user_group;
                }
                else {
                    receiver.autoAssignOwner = 'false';
                    receiver.assignedOwner = objSysProp.receiver_profile.hiplink_mobile.default_assigned_owner;
                }
            }
            else if (userRoleName.lastIndexOf('.sms_text') > 0) {

                receiver.name += objSysProp.receiver_profile.sms_text.name_suffix;
                receiver.description += objSysProp.receiver_profile.sms_text.description_suffix;

                receiver.carrier = objSysProp.receiver_profile.sms_text.carrier_name;
                receiver.pin = objSysProp.receiver_profile.sms_text.pin_prefix
                    + this.getCleanPin(user.mobile_phone.toString(), objSysProp.receiver_profile.sms_text.pin_filter)
                    + objSysProp.receiver_profile.sms_text.pin_suffix;
                receiver.type = objSysProp.receiver_profile.sms_text.type;

                if (receiver.emailAddress !== '') {

                    receiver.emailCC = objSysProp.receiver_profile.sms_text.email_cc;
                    receiver.emailFailover = objSysProp.receiver_profile.sms_text.email_failover;
                }
            }
            else if (userRoleName.lastIndexOf('.voice_call') > 0) {

                receiver.name += objSysProp.receiver_profile.voice_call.name_suffix;
                receiver.description += objSysProp.receiver_profile.voice_call.description_suffix;

                receiver.carrier = objSysProp.receiver_profile.voice_call.carrier_name;
                receiver.pin = objSysProp.receiver_profile.voice_call.pin_prefix
                    + this.getCleanPin(user.phone.toString(), objSysProp.receiver_profile.voice_call.pin_filter)
                    + objSysProp.receiver_profile.voice_call.pin_suffix;
                receiver.type = objSysProp.receiver_profile.voice_call.type;

                if (receiver.emailAddress !== '') {

                    receiver.emailCC = objSysProp.receiver_profile.voice_call.email_cc;
                    receiver.emailFailover = objSysProp.receiver_profile.voice_call.email_failover;
                }
            }

            receiver.name += objSysProp.recipient_name_ident.suffix;

            receiver.firstName = this.getCleanFirstLastName(user.first_name.toString());
            receiver.lastName = this.getCleanFirstLastName(user.last_name.toString());

            if (objSysProp.multi_department.enabled) {
                receiver.department = user.department.toString();
            }
            else {
                receiver.department = objSysProp.multi_department.default_department;
            }

            if (user.locked_out.toString() === '1') {
                receiver.disabled = 'true';
            }
            else {
                receiver.disabled = 'false';
            }
        }

        return receiver;
    },

    getHLReceiverName: function (userRoleID, userRoleName, userID, user) {

        var receiverName = '';

        if (userRoleName === null && userRoleID !== null) {
            userRoleName = this.objDataOperations.getUserRoleName(userRoleID);
        }

        if (userRoleName !== null && userRoleName !== '') {

            receiver.roleName = userRoleName;

            if (user === null && userID !== null) {
                user = this.objDataOperations.getUser(userID);
            }
        }

        if (userRoleName !== null && user !== null) {

            var objSysProp = this.objSystemProperties;

            receiverName = this.objSystemProperties.recipient_name_ident.prefix
                + user.user_name.toString();

            if (userRoleName.lastIndexOf('.email') > 0) {
                receiverName += objSysProp.receiver_profile.email.name_suffix;
            }
            else if (userRoleName.lastIndexOf('.hiplink_mobile') > 0) {
                receiverName += objSysProp.receiver_profile.hiplink_mobile.name_suffix;
            }
            else if (userRoleName.lastIndexOf('.sms_text') > 0) {
                receiverName += objSysProp.receiver_profile.sms_text.name_suffix;
            }
            else if (userRoleName.lastIndexOf('.voice_call') > 0) {
                receiverName += objSysProp.receiver_profile.voice_call.name_suffix;
            }

            receiverName += objSysProp.recipient_name_ident.suffix;
        }

        return receiverName;
    },

    getHLRecipGroupData: function (groupRoleID, groupRoleName, groupID, group) {

        var recipGroup = {
            roleName: '',
            name: '',
            description: '',
            department: '',
            type: '',
            disabled: ''
        };

        if (groupRoleName === null && groupRoleID !== null) {
            groupRoleName = this.objDataOperations.getGroupRoleName(groupRoleID);
        }

        if (groupRoleName !== null && groupRoleName !== '') {

            recipGroup.roleName = groupRoleName;

            if (group === null && groupID !== null) {
                group = this.objDataOperations.getGroup(groupID);
            }
        }

        if (groupRoleName !== null && group !== null) {

            var objSysProp = this.objSystemProperties;

            recipGroup.name = objSysProp.recipient_name_ident.prefix
                + group.name.toString();
            recipGroup.description = group.name.toString();

            if (groupRoleName.lastIndexOf('.all') > 0) {

                recipGroup.name += ' (All)';
                recipGroup.description += ' (All)';
            }
            else if (groupRoleName.lastIndexOf('.email') > 0) {

                recipGroup.name += objSysProp.receiver_profile.email.name_suffix;
                recipGroup.description += objSysProp.receiver_profile.email.description_suffix;
            }
            else if (groupRoleName.lastIndexOf('.hiplink_mobile') > 0) {

                recipGroup.name += objSysProp.receiver_profile.hiplink_mobile.name_suffix;
                recipGroup.description += objSysProp.receiver_profile.hiplink_mobile.description_suffix;
            }
            else if (groupRoleName.lastIndexOf('.sms_text') > 0) {

                recipGroup.name += objSysProp.receiver_profile.sms_text.name_suffix;
                recipGroup.description += objSysProp.receiver_profile.sms_text.description_suffix;
            }
            else if (groupRoleName.lastIndexOf('.voice_call') > 0) {

                recipGroup.name += objSysProp.receiver_profile.voice_call.name_suffix;
                recipGroup.description += objSysProp.receiver_profile.voice_call.description_suffix;
            }

            recipGroup.name += objSysProp.recipient_name_ident.suffix;
            if (group.description.toString() !== '')
                recipGroup.description += ' - ' + group.description.toString();

            recipGroup.department = this.objSystemProperties.multi_department.default_department;
            recipGroup.type = 'Broadcast';
            recipGroup.disabled = 'false';
        }

        return recipGroup;
    },

    getHLRecipGroupName: function (groupRoleID, groupRoleName, groupID, group) {

        var recipGroupName = '';

        if (groupRoleName === null && groupRoleID !== null) {
            groupRoleName = this.objDataOperations.getGroupRoleName(groupRoleID);
        }

        if (groupRoleName !== null && groupRoleName !== '') {

            recipGroup.roleName = groupRoleName;

            if (group === null && groupID !== null) {
                group = this.objDataOperations.getGroup(groupID);
            }
        }

        if (groupRoleName !== null && group !== null) {

            var objSysProp = this.objSystemProperties;

            recipGroupName = objSysProp.recipient_name_ident.prefix
                + group.name.toString();

            if (groupRoleName.lastIndexOf('.all') > 0) {
                recipGroupName += ' (All)';
            }
            else if (groupRoleName.lastIndexOf('.email') > 0) {
                recipGroupName += objSysProp.receiver_profile.email.name_suffix;
            }
            else if (groupRoleName.lastIndexOf('.hiplink_mobile') > 0) {
                recipGroupName += objSysProp.receiver_profile.hiplink_mobile.name_suffix;
            }
            else if (groupRoleName.lastIndexOf('.sms_text') > 0) {
                recipGroupName += objSysProp.receiver_profile.sms_text.name_suffix;
            }
            else if (groupRoleName.lastIndexOf('.voice_call') > 0) {
                recipGroupName += objSysProp.receiver_profile.voice_call.name_suffix;
            }

            recipGroupName += objSysProp.recipient_name_ident.suffix;
        }

        return recipGroupName;
    },

    getHLRecipGroupsMembersData: function (groupID, userID, assignedGroupRoleNames, assignedUserRoleNames) {

        var recipGroupMembers = {
            all: {
                name: '',
                members: []
            },
            email: {
                name: '',
                members: []
            },
            hiplink_mobile: {
                name: '',
                members: []
            },
            sms_text: {
                name: '',
                members: []
            },
            voice_call: {
                name: '',
                members: []
            }
        };

        if (typeof assignedGroupRoleNames === 'undefined'
            || assignedGroupRoleNames === null) {

            assignedGroupRoleNames = this.objDataOperations.getAssignedGroupRoleNames(groupID);
        }

        if (assignedGroupRoleNames.length > 0) {

            if (typeof assignedUserRoleNames === 'undefined'
                || assignedUserRoleNames === null) {

                assignedUserRoleNames = this.objDataOperations.getAssignedUserRoleNames(userID);
            }

            if (assignedUserRoleNames.length > 0) {

                for (var iGroup = 0; iGroup < assignedGroupRoleNames.length; iGroup++) {

                    var groupRoleName = assignedGroupRoleNames[iGroup];

                    var recipGroupName = this.getHLRecipGroupName(null, groupRoleName, groupID, null);

                    if (recipGroupName !== '') {

                        if (groupRoleName.lastIndexOf('.all') > 0) {
                            recipGroupMembers.all.name = recipGroupName;
                        }
                        else if (groupRoleName.lastIndexOf('.email') > 0) {
                            recipGroupMembers.email.name = recipGroupName;
                        }
                        else if (groupRoleName.lastIndexOf('.hiplink_mobile') > 0) {
                            recipGroupMembers.hiplink_mobile.name = recipGroupName;
                        }
                        else if (groupRoleName.lastIndexOf('.sms_text') > 0) {
                            recipGroupMembers.sms_text.name = recipGroupName;
                        }
                        else if (groupRoleName.lastIndexOf('.voice_call') > 0) {
                            recipGroupMembers.voice_call.name = recipGroupName;
                        }
                    }
                }

                for (var iUser = 0; iUser < assignedUserRoleNames.length; iUser++) {

                    var userRoleName = assignedUserRoleNames[iUser];

                    var receiverName = this.getHLReceiverName(null, userRoleName, userID, null);

                    if (receiverName !== '') {

                        recipGroupMembers.all.members.push(receiverName);

                        if (receiverName !== '') {

                            if (userRoleName.lastIndexOf('.email') > 0) {
                                recipGroupMembers.email.members.push(receiverName);
                            }
                            else if (userRoleName.lastIndexOf('.hiplink_mobile') > 0) {
                                recipGroupMembers.hiplink_mobile.members.push(receiverName);
                            }
                            else if (userRoleName.lastIndexOf('.sms_text') > 0) {
                                recipGroupMembers.sms_text.members.push(receiverName);
                            }
                            else if (userRoleName.lastIndexOf('.voice_call') > 0) {
                                recipGroupMembers.voice_call.members.push(receiverName);
                            }
                        }
                    }
                }
            }
        }

        return recipGroupMembers;
    },

    getCleanPin: function (data, filter) {

        var cleanData = data;

        if (filter === 'numeric') {
            cleanData = data.replace(/[\D]/g, '');
        }
        else if (filter === 'numeric-comma') {
            cleanData = data.replace(/[^\d,]/g, '');
        }

        return cleanData;
    },

    getCleanFirstLastName: function (data) {

        var cleanData = data.replace(/[^a-zA-Z0-9_'.\- ()&]/g, '');
        return cleanData;
    },

    invokeAddReceiver: function (receiver) {
        return this.objHipLinkWebService.addReceiver(receiver.name,
            receiver.description, receiver.department, receiver.carrier, receiver.pin,
            receiver.type, receiver.firstName, receiver.lastName,
            receiver.emailAddress, receiver.emailCC, receiver.emailFailover,
            receiver.assignedOwner, receiver.autoAssignOwner, receiver.ownerUserGroup,
            receiver.disabled);
    },

    invokeUpdateReceiver: function (name, receiver) {
        return this.objHipLinkWebService.updateReceiver(name, receiver.name,
            receiver.description, receiver.department, receiver.carrier, receiver.pin,
            receiver.type, receiver.firstName, receiver.lastName,
            receiver.emailAddress, receiver.emailCC, receiver.emailFailover,
            receiver.assignedOwner, receiver.autoAssignOwner, receiver.ownerUserGroup,
            receiver.disabled);
    },

    invokeDeleteReceiver: function (name) {
        return this.objHipLinkWebService.deleteReceiver(name);
    },

    invokeAddRecipGroup: function (recipGroup) {
        return this.objHipLinkWebService.addRecipientGroup(recipGroup.name,
            recipGroup.description, recipGroup.department, recipGroup.type, recipGroup.disabled);
    },

    invokeUpdateRecipGroup: function (name, recipGroup) {
        return this.objHipLinkWebService.updateRecipientGroup(name, recipGroup.name,
            recipGroup.description, recipGroup.department, recipGroup.type, recipGroup.disabled);
    },

    invokeDeleteRecipGroup: function (name) {
        return this.objHipLinkWebService.deleteRecipientGroup(name);
    },

    invokeAddRecipGroupMember: function (name, member) {
        return this.objHipLinkWebService.addRecipientGroupMember(name, member);
    },

    invokeDeleteRecipGroupMember: function (name, member) {
        return this.objHipLinkWebService.deleteRecipientGroupMember(name, member);
    },

    type: 'hiplink_contacts_sync_operations'
};

hiplink_contacts_sync_operations.getInstance = function () {

    if (typeof hiplink_contacts_sync_operations._instance === 'undefined') {
        hiplink_contacts_sync_operations._instance = new hiplink_contacts_sync_operations();
    }

    return hiplink_contacts_sync_operations._instance;
};
]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-04-11 09:14:12</sys_created_on>
        <sys_id>d84378701bb8330079ee2136ec4bcb70</sys_id>
        <sys_mod_count>165</sys_mod_count>
        <sys_name>hiplink_contacts_sync_operations</sys_name>
        <sys_package display_value="HipLink Unified IT Alerting" source="x_hls_hiplink">5385a1ff1b10330079ee2136ec4bcb24</sys_package>
        <sys_policy>protected</sys_policy>
        <sys_scope display_value="HipLink Unified IT Alerting">5385a1ff1b10330079ee2136ec4bcb24</sys_scope>
        <sys_update_name>sys_script_include_d84378701bb8330079ee2136ec4bcb70</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-11-19 07:59:45</sys_updated_on>
    </sys_script_include>
</record_update>
